<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.1/css/buttons.dataTables.min.css" />

<style type="text/css">
    .dt-buttons {
        display: none;
    }
    #example_filter{display:none;}
</style>
@*<a href="#" class="btn btn-success btn-sm">
    <span class="glyphicon glyphicon-download-alt"></span>
</a>*@
@*<div> <a href="" onclick="get_url()" class="icon-link icon-primary icon-large" target="_blank"><i class="glyphicon glyphicon-trash"></i></a></div>*@
@*<button title="Descargar Archivo" class="btn btn-primary"><span class="glyphicon glyphicon-download-alt"></span></button>*@
<table id="example" class="table table-hover dataTable  table-striped table-responsive">    
    <thead>
        <tr style="background-color:#3d566e; color:#ecf0f1">
            <th>Guía Origen</th>
            <th>Guía Destino</th>
            <th>Tienda Origen</th>
            <th>Tienda Destino</th>
            <th>Fecha Destino</th>
            <th>Envio</th>
            <th>Fecha Envio</th>
            <th>Acciones</th>
            <th>Fecha recepción</th>
        </tr>
    </thead>
    <tbody data-bind="foreach:"></tbody>
    <tfoot>
        <tr>
            <th>Guía Origen</th>
            <th>Guía Destino</th>
            <th>Tienda Origen</th>
            <th>Tienda Destino</th>
            <th>Fecha Destino</th>
            <th>Envio</th>
            <th>Fecha Envio</th>
            <th>Acciones</th>
            <th>Fecha recepción</th>
        </tr>
    </tfoot>
</table>

@*<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-app>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>*@

<script src='https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js'></script>
<script src='//cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js'></script>


<script>
    $(document).ready(function () {
    //    alert("entro a _guiatable.cshmtl - document ready");
        $('.table').dataTable({
            "language": {
                "url": "../Scripts/DataTables/Spanish.json"
            },
            "bProcessing": true, // se agrego para probar
            "bServerSide": true,
            "bAutoWidth": false,
            "sAjaxSource": '@Url.Action("getGuiaAjax", "Consulta")',
            "fnServerParams": function (aoData) {
                aoData.push({ "name": "tda_destino", "value": $('#txtTda').val() });
                aoData.push({ "name": "num_guia", "value": $.trim($('#numguia').val()) });
            },
            "bdestroy": true,
            "start": 0,
            "order": [0, "asc"],
            "bDeferRender": true,
            "aoColumns": [
                    { "sName": "num_gudis", "mData": "num_gudis" },
                    { "sName": "num_guia", "mData": "num_guia" },
                    { "sName": "tienda_origen", "mData": "tienda_origen" },
                    { "sName": "tienda_destino", "mData": "tienda_destino" },
                    { "sName": "fecha_des", "mData": "fecha_des" },
                    {
                        "render": function (data, type, full) {
                           // console.log(full.desc_send_tda);
                            if (full.desc_send_tda == 'X') {
                                return '<div style="display: block;background-color: #41b341;" class="badge badge-pill badge-success disabled"><a class="badge badge-success disabled" style=" background-color: #41b341;"  >Enviado</a></div>';
                            } else {
                                return '<div style="display: block;background-color: #3d566e;" class="badge badge-pill badge-default disabled"><a class="badge badge-default disabled" style=" background-color: #3d566e;"  >No enviado</a></div>';
                            }
                        }
                    },
                    { "sName": "fec_env", "mData": "fec_env" },
                    {
                        "render": function (data, type, full) {
                            //if (full.desc_send_tda == 'X') {
                                //return '<div> <a title="Guias ya enviados" target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-send"></span> Ya Enviado</a></div>';
                            //} else {
                                var desc_almac = full.tienda_origen.split('-');
                                var envio = "'" + desc_almac[0] + "','" + full.num_gudis + "'"
                          //      console.log(full.desc_send_tda);
                               // console.log(desc_almac[0]);
                              //  return '<div> <a title="Enviar Guía" target="_blank" data-desc-almac="' + desc_almac[0] + '" data-num-gudis="' + full.num_gudis + '" class="js-open-popup btn btn-primary btn-sm"> <span class="glyphicon glyphicon-send"></span> Enviar</a></div>';
                            //}
                              //  console.log(full.desc_send_tda);
                               // console.log(full.mc_id);
                              //  console.log(full);
                                if (full.desc_send_tda == 'X' && full.mc_id > 0) {
                                   // return '<div style="display: block;background-color: #41b341;" class="badge badge-pill badge-success"><a class="badge badge-success" style=" background-color: #41b341;"  >Enviado</a></div>';
                                    return '<div> <a title="Enviado" target="_blank" class="js-open-popup btn btn-default btn-sm disabled"> <span class="glyphicon glyphicon-send"></span>  Enviado </a></div>';
                                }
                                else {
                                    return '<div> <a title="Enviar Guía" target="_blank" data-desc-almac="' + desc_almac[0] + '" data-num-gudis="' + full.num_gudis + '" class="js-open-popup btn btn-primary btn-sm"> <span class="glyphicon glyphicon-send"></span>  Enviar</a></div>';
                                }

                        }
                    },            
                   { "sName": "fec_recep", "mData": "fec_recep" },
            ],
            dom: 'Bfrtip',
            buttons: [
            {
                extend: 'excelHtml5',
                title: 'Bataclub_xls'
            },
            {
                extend: 'csvHtml5',
                title: 'BataClub_csv'
            },
            {
                extend: 'pdfHtml5',
                title: 'BataClub_pdf'
            },
            'copyHtml5',
            ]
        });

      
    });

</script>