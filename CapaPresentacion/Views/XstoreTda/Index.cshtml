@using CapaEntidad.XstoreTda
@model IEnumerable<Ent_TiendaConf>
@{
    ViewBag.Title = "Consulta de Tiendas";
    AjaxOptions options = new AjaxOptions
    {
        HttpMethod = "GET",
        InsertionMode = InsertionMode.Replace,
        UpdateTargetId = "lista",
        OnComplete = "waitingDialog.hide();",
        OnBegin = "waitingDialog.show('Espere un momento por favor');",
        OnFailure = "waitingDialog.hide();"
    };
}

<link href="~/ContentSelect/bootstrap-select.css" rel="stylesheet" />
<link href="@Url.Content("~/Content/bootstrap-select.min.css")" rel="stylesheet" type="text/css" />
@*<link href="~/Scripts/AdminLTE/plugins/iCheck/all.css" rel="stylesheet" type="text/css" />*@

<style>
    /* The container */
    .container {
        display: block;
        position: relative;
        padding-left: 35px;
        margin-bottom: 0px;
        cursor: pointer;
        /*font-size: 22px;*/
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

        /* Hide the browser's default checkbox */
        .container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

    /* Create a custom checkbox */
    .checkmark {
        position: absolute;
        top: 0;
        left: 0;
        height: 22px;
        width: 22px;
        background-color: #eee;
    }

    /* On mouse-over, add a grey background color */
    .container:hover input ~ .checkmark {
        background-color: #ccc;
    }

    /* When the checkbox is checked, add a blue background */
    .container input:checked ~ .checkmark {
        background-color: #dd4b39;
    }

    /* Create the checkmark/indicator (hidden when not checked) */
    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
    }

    /* Show the checkmark when checked */
    .container input:checked ~ .checkmark:after {
        display: block;
    }

    /* Style the checkmark/indicator */
    .container .checkmark:after {
        left: 9px;
        top: 5px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 3px 3px 0;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
    }
</style>

<p class="text-danger">Consulta de tiendas para que puedan ser activadas o desactivadas</p>
<div class="box box-body box-primary">
    <div class="row">
        <div class="col-sm-2">

        </div>
        <div class="col-sm-2">
            <label for="segape">Tiendas Xstore:</label>
        </div>
        <div class="col-sm-2" id="TotalXstore">

        </div>
        <div class="col-sm-2">
            <label for="segape">Tiendas no Xstore :</label>
        </div>
        <div class="col-sm-2" id="TotalNXstore">
        </div>

    </div>

    <div class="box-body" id="lista" style="overflow-x: auto;">
        <table id="example" class="table table-hover dataTable  table-striped table-responsive">
            <thead>
                <tr style="background-color:#3d566e; color:#ecf0f1">
                    @*<th>Cod Tienda</th>*@
                    <th>Des tienda</th>
                    @*<th>Cod Empresa</th>*@
                    <th>Des Empresa</th>
                    <th>Cadena</th>
                    <th>Xstore</th>
                    <th>Interface</th>
                    <th>Detalle</th>
                    <th>XCenter</th>
                    <th>G. Correlativo</th>
                    <th>Venta Hist.</th>
                    <th>Enviar Stock</th>

                </tr>
            </thead>
            <tbody data-bind="foreach:"></tbody>
            <tfoot>
                <tr>
                    @*<th>Cod Tienda</th>*@
                    <th>Des tienda</th>
                    @*<th>Cod Empresa</th>*@
                    <th>Des Empresa</th>
                    <th>Cadena</th>
                    <th>Xstore</th>
                    <th>Interface</th>
                    <th>Detalle</th>
                    <th>XCenter</th>
                    <th>G. Correlativo</th>
                    <th>Venta Hist.</th>
                    <th>Enviar Stock</th>
                </tr>
            </tfoot>
        </table>
    </div>
    <br />

</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" ng-app>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>
<script src="~/Scripts/bootstrap-select.min.js"></script>
<script src="@Url.Content("~/Scripts/bootstrap.min.js")"></script>
@*<script src="~/Scripts/AdminLTE/plugins/iCheck/icheck.min.js" type="text/javascript"></script>*@
<script>
    $(document).ready(function () {

        $('.table').dataTable({
            "language": {
                "url": "../Scripts/DataTables/Spanish.json"
            },
            "bServerSide": true,
            "bAutoWidth": false,
            "sAjaxSource": '@Url.Action("getTienda", "XstoreTda")',
            "bdestroy": true,
            "start": 0,
            "order": [0, "asc"],
            "bDeferRender": true,
            "aoColumns": [
                  { "sName": "des_Entid", "mData": "des_Entid" },
                  { "sName": "des_Emp", "mData": "des_Emp", "sClass": "right" },
                  { "sName": "des_Cadena", "mData": "des_Cadena", "sClass": "right" },
                   {
                       "render": function (data, type, full) {
                           var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "'"
                            

                           if (full.cod_Entid != 'EC') {                                                          
                               if (full.bol_xstore == 'True') {
                                   return '<div> <a title="Xstore Activado"  onclick="PopupDesactivarTienda(' + envio + ')" target="_blank" class="btn btn-success btn-sm"> <span class="glyphicon glyphicon-off"></span></a></div>';
                               } else {
                                   return '<div> <a title="Xstore Desactivo"  onclick="PopupActivarTienda(' + envio + ')" target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-off"></span></a></div>';
                               }
                           }
                           else
                           {
                               return '<div>  <label for="segape"></label></div>';
                           }
                       }
                   },
                   {
                       "render": function (data, type, full) {

                           if (full.cod_Entid != 'EC') {
                               var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "','" + full.outlet + "'"

                               return '<div> <a title="enviar Interface"  onclick="PopupInterfacexDefecto(' + envio + ')" target="_blank" class="btn btn-warning btn-sm"> <span class="glyphicon glyphicon-send"></span></a></div>';
                           }
                           else {
                               return '<div>  <label for="segape"></label></div>';
                           }

                           
                       }
                   },
                   {
                       "render": function (data, type, full) {
                           if (full.cod_Entid != 'EC') {
                               var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "','" + full.outlet + "'"

                               return '<div> <a title="Ver Detalle"  onclick="PopupDetalle(' + envio + ')" target="_blank" class="btn btn-primary btn-sm"> <span class="	glyphicon glyphicon-th-list"></span></a></div>';
                           }
                           else {
                               return '<div>  <label for="segape"></label></div>';
                           }
                       }
                   },
                    {
                        "render": function (data, type, full) {

                            if (full.cod_Entid != 'EC') {

                                var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "'";

                                if (full.bol_xstore == 'True') {
                                    return '<div> <a title="XCenter Detalle"  onclick="PopupDetalleXcenter(' + envio + ')" target="_blank" class="btn btn-danger btn-sm"> <span class="glyphicon glyphicon-briefcase"></span></a></div>';
                                } else {
                                    return '<div> <a title="XCenter Detalle"  class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-list-alt"></span></a></div>';
                                }
                            }
                            else {
                                return '<div>  <label for="segape"></label></div>';
                            }
                        }
                    },
                    {
                        "render": function (data, type, full) {

                            if (full.cod_Entid != 'EC') {

                                var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "'"

                                if (full.bol_gcorrelativo == '1') {

                                    return '<div> <a title="Correlativos ya generados" target="_blank" class="btn btn-default btn-sm"> <span class="fa fa-cogs"></span></a></div>';
                                } else {
                                    return '<div> <a title="Generar correlativos"  onclick="PopupGenerarCorrelativo(' + envio + ')" target="_blank" class="btn btn-primary btn-sm"> <span class="fa fa-cogs"></span></a></div>';
                                }
                            }
                            else {
                                return '<div>  <label for="segape"></label></div>';
                            }
                        }
                    },
                   {
                       "render": function (data, type, full) {
                           var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "'"


                           if (full.bol_xstore == 'True') {
                               return '<div> <a title="enviar Ventas Historicas"  onclick="PopupVentasHistoricas(' + envio + ')" target="_blank" class="btn btn-warning btn-sm"> <span class="glyphicon glyphicon-list-alt"></span></a></div>';

                           } else {
                               return '<div> <a title="Debe activar la tienda"  target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-list-alt"></span></a></div>';
                           }


                       }
                   },
                   {
                       "render": function (data, type, full) {

                           if (full.cod_Entid != 'EC') {

                               var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "'"


                               if (full.bol_xstore == 'True') {
                                   return '<div> <a title="enviar stock"  onclick="PopupGenerarStock(' + envio + ')" target="_blank" class="btn btn-info btn-sm"> <span class="glyphicon glyphicon-barcode"></span></a></div>';

                               } else {
                                   return '<div> <a title="Debe activar la tienda"  target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-barcode"></span></a></div>';
                               }
                           }
                           else {
                               return '<div>  <label for="segape"></label></div>';
                           }
                       }
                   }
            ],
            dom: 'Bfrtip',
            buttons: [
           {
               extend: 'excelHtml5',
               title: 'Bataclub_xls'
           },
           {
               extend: 'csvHtml5',
               title: 'BataClub_csv'
           },
           {
               extend: 'pdfHtml5',
               title: 'BataClub_pdf'
           },
           'copyHtml5',
            ]
        });

        Obtenertotales();
    });

    function MostrarListado() {

        var table = $('.table').dataTable();
        var value = $('.dataTables_filter input').val();

        var strCadena=' <table id="example" class="table table-hover dataTable  table-striped table-responsive">'+
                            '<thead>'+
                            '<tr style="background-color:#3d566e; color:#ecf0f1">'+
                            //'<th>Cod Tienda</th>'+
                            '<th>Des tienda</th>'+
                            //'<th>Cod Empresa</th>'+
                            '<th>Des Empresa</th>'+
                            '<th>Cadena</th>'+
                            '<th>Xstore</th>' +
                            '<th>Interface</th>' +
                            '<th>Detalle</th>' +
                            '<th>XCenter</th>' +
                            '<th>G. Correlativo</th>' +
                             '<th>Venta Hist.</th>' +
                            '<th>Enviar Stock</th>'+
                            '</tr>'+
                            ' </thead>'+
                            '<tbody data-bind="foreach:"></tbody>'+
                            '<tfoot>'+
                            '<tr>'+
                            //'<th>Cod Tienda</th>'+
                            '<th>Des tienda</th>'+
                            //'<th>Cod Empresa</th>'+
                            '<th>Des Empresa</th>'+
                            ' <th>Cadena</th>'+
                            ' <th>Xstore</th>' +
                            ' <th>Interface</th>' +
                            ' <th>Detalle</th>' +
                            '<th>XCenter</th>' +
                            '<th>G. Correlativo</th>' +
                            '<th>Venta Hist.</th>' +
                            '<th>Enviar Stock</th>' +
                            '</tr>'+
                            ' </tfoot>'+
                        '</table>'
        document.getElementById("lista").innerHTML = strCadena;


        $('.table').dataTable({
            "language": {
                "url": "../Scripts/DataTables/Spanish.json"
            },
            "bServerSide": true,
            "bAutoWidth": false,
            "sAjaxSource": '@Url.Action("getTienda", "XstoreTda")',
            "bdestroy": true,
            "start": 0,
            "oSearch": { "sSearch": value },
            "order": [0, "asc"],
            "bDeferRender": true,
            "aoColumns": [
                 //{ "sName": "cod_Entid", "mData": "cod_Entid" },
                   { "sName": "des_Entid", "mData": "des_Entid" },

                   //{ "sName": "cod_Emp", "mData": "cod_Emp", "sClass": "center" },
                   { "sName": "des_Emp", "mData": "des_Emp", "sClass": "right" },
                   { "sName": "des_Cadena", "mData": "des_Cadena", "sClass": "right" },
                   {
                       "render": function (data, type, full) {
                           var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "'"

                           if (full.bol_xstore == 'True') {

                               return '<div> <a title="Xstore Activado"  onclick="PopupDesactivarTienda(' + envio + ')" target="_blank" class="btn btn-success btn-sm"> <span class="glyphicon glyphicon-off"></span></a></div>';
                           } else {
                               return '<div> <a title="Xstore Desactivo"  onclick="PopupActivarTienda(' + envio + ')" target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-off"></span></a></div>';
                           }
                       }
                   },
                    {
                        "render": function (data, type, full) {
                            var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "'"

                            return '<div> <a title="enviar Interface"  onclick="PopupInterfacexDefecto(' + envio + ')" target="_blank" class="btn btn-warning btn-sm"> <span class="glyphicon glyphicon-send"></span></a></div>';
                        }
                    },
                   {
                       "render": function (data, type, full) {
                           var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "'"

                           return '<div> <a title="Ver Detalle"  onclick="PopupDetalle(' + envio + ')" target="_blank" class="btn btn-primary btn-sm"> <span class="	glyphicon glyphicon-th-list"></span></a></div>';
                       }
                   },
                     {
                         "render": function (data, type, full) {
                             var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "'";

                             if (full.bol_xstore == 'True') {
                                 return '<div> <a title="Xcenter Detalle"  onclick="PopupDetalleXcenter(' + envio + ')" target="_blank" class="btn btn-danger btn-sm"> <span class="glyphicon glyphicon-briefcase"></span></a></div>';
                             } else {
                                 return '<div> <a title="Xcenter Detalle"  class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-list-alt"></span></a></div>';
                             }
                         }
                     },
                    {
                        "render": function (data, type, full) {
                            var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "'"

                            if (full.bol_gcorrelativo == '1') {

                                return '<div> <a title="Correlativos ya generados" target="_blank" class="btn btn-default btn-sm"> <span class="fa fa-cogs"></span></a></div>';
                            } else {
                                return '<div> <a title="Generar correlativos"  onclick="PopupGenerarCorrelativo(' + envio + ')" target="_blank" class="btn btn-primary btn-sm"> <span class="fa fa-cogs"></span></a></div>';
                            }
                        }
                    },
                     {
                         "render": function (data, type, full) {
                             var envio = "/'" + full.cod_Entid + "'/,'" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "'"


                             if (full.bol_xstore == 'True') {
                                 return '<div> <a title="enviar Ventas Historicas"  onclick="PopupVentasHistoricas(' + envio + ')" target="_blank" class="btn btn-warning btn-sm"> <span class="glyphicon glyphicon-list-alt"></span></a></div>';

                             } else {
                                 return '<div> <a title="Debe activar la tienda"  target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-list-alt"></span></a></div>';
                             }


                         }
                     },
                   {
                       "render": function (data, type, full) {
                           var envio = "'" + full.cod_Entid + "','" + full.des_Entid + "','" + full.direccion + "','" + full.cod_Jefe + "','" + full.consecionario + "'"


                           if (full.bol_xstore == 'True') {
                               return '<div> <a title="enviar stock"  onclick="PopupGenerarStock(' + envio + ')" target="_blank" class="btn btn-info btn-sm"> <span class="glyphicon glyphicon-barcode"></span></a></div>';

                           } else {
                               return '<div> <a title="Debe activar la tienda"  target="_blank" class="btn btn-default btn-sm"> <span class="glyphicon glyphicon-barcode"></span></a></div>';
                           }


                       }
                   }
            ],
            dom: 'Bfrtip',
            buttons: [
           {
               extend: 'excelHtml5',
               title: 'Bataclub_xls'
           },
           {
               extend: 'csvHtml5',
               title: 'BataClub_csv'
           },
           {
               extend: 'pdfHtml5',
               title: 'BataClub_pdf'
           },
           'copyHtml5',
            ]
        });

    }

    function PopupDesactivarTienda(codTienda,descTeinda) {


            var strhtml = ''
            strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
            strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
            strhtml += '<h5 class="modal-title" id="myModalLabel">'
            strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
            strhtml += '<tr>'
            strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Confirmar Desactivación</td>'
            strhtml += '</tr>'
            strhtml += '</table>'
            strhtml += '</h5>'
            strhtml += '</div>'
            strhtml += '<div class="modal-body">'
            strhtml += 'Desea desactivar la Tienda: <b>' + descTeinda + ' </b>?.'
            strhtml += '</div>'
            strhtml += '<div class="modal-footer" style="margin-top:-30px">'
            strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'
            strhtml += '<button type="button" class="btn btn-danger"  onclick="ActualizarTienda(' + codTienda + ',0)"   data-dismiss="modal">Desactivar</button>'
            //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
            //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
            strhtml += '</div>'
            var options = { "backdrop": "static", keyboard: true };

            $('#myModalContent').html(strhtml);
            $('#myModal').modal(options);
            $('#myModal').modal('show');


    }

    function PopupActivarTienda(codTienda,descTeinda) {

            var strhtml = ''
            strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
            strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
            strhtml += '<h5 class="modal-title" id="myModalLabel">'
            strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
            strhtml += '<tr>'
            strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Confirmar Activación</td>'
            strhtml += '</tr>'
            strhtml += '</table>'
            strhtml += '</h5>'
            strhtml += '</div>'
            strhtml += '<div class="modal-body">'
            strhtml += 'Desea activar la Tienda: <b>' + descTeinda + '</b> ?.'
            strhtml += '</div>'
            strhtml += '<div class="modal-footer" style="margin-top:-30px">'
            strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'
            strhtml += '<button type="button" class="btn btn-primary"  onclick="ActualizarTienda('+codTienda+',1)"   data-dismiss="modal">Activar</button>'
            //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
            //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
            strhtml += '</div>'
            var options = { "backdrop": "static", keyboard: true };

            $('#myModalContent').html(strhtml);
            $('#myModal').modal(options);
            $('#myModal').modal('show');

    }

    function ActualizarTienda(codEntid,Estado) {

        waitingDialog.show('Espere un momento por favor');

        var objTienda = {
            CodTienda: codEntid,
            estado: Estado
        }

        var msj = 'desactivada.'

        if (parseInt(Estado) > 0)
            msj = 'activada.'

        $.ajax
          ({
              url: '../XstoreTda/ActualizarEstadoTienda',
              dataType: "json",
              type: "POST",
              data: objTienda,
              success: function (data, textStatus, XMLHttpRequest) {
                  waitingDialog.hide();

                  if ((data.Success).toString() == "true") {

                      if (data.Message == "1") {
                          toastr.success("La tienda Nro: " + codEntid + " fue " + msj, "Mensaje");
                          MostrarListado();
                          waitingDialog.hide();

                      } else {

                          toastr.success("La tienda Nro: " + codEntid + " no fue " + msj, "Error");
                          MostrarListado();
                          waitingDialog.hide();
                      }

                  } else {
                      toastr.error("No fue " + msj + " la tienda: " + codEntid, "Error");
                      waitingDialog.hide();
                  }

              },
              error: function (xhr) {
                  waitingDialog.hide();
                  toastr.error(xhr, 'Error');
                  waitingDialog.hide();
              }
          })

    }

    function PopupDetalle(codTienda, descTienda, Direccion, Jefe, Concesion,outlet) {

        waitingDialog.show('Espere un momento por favor');

        var ControllerUrl = "@Url.Action("listarStr_DatosTienda", "XstoreTda")";

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { codTienda: codTienda },
            datatype: "json",
            cache: true,
            success: function (data) {

                if (data != '' && data != '[]') {

                    var valors = JSON.parse(data);

                    var strStock = '';
                    var strCorrelativo = '';

                    var molde = '<tr id="IdTr"  >'
                        molde += '<td colspan="1" valign="middle"><label  id="lblId" name="nombre">etiqueta</label></td>'
                        molde += '<td colspan="1">'
                        molde += '&nbsp;&nbsp;Valor'
                        molde += '</td>'
                        molde += '<td colspan="1" valign="middle"><label  id="lblId" name="nombre1">etiqueta1</label></td>'
                        molde += '<td colspan="1">'
                        molde += '&nbsp;&nbsp;Valor1'
                        molde += '</td>'
                        molde += '</tr>'
                        var i = 0;
                        var Ci = 0
                        var tmpMoldeC = ''

                        var j = 0;
                        var Cj = 0;
                        var tmpMoldeS = ''

                    $.each(valors, function (index, item) {

                        var tipo = item.TIPO;
                        var etiqueta = item.DESCRIPCION;
                        var des1 = item.DES1;
                        var des2 = item.DES2;

                        if (tipo == 'C') {
                            Ci++;
                            var sub = '';
                            if (Ci == 1) { i++; strCorrelativo += molde; }
                            if (Ci == 2) { sub = '1'; Ci = 0 }

                            strCorrelativo = strCorrelativo.replace("IdTr" + sub, "trC" + i);
                            strCorrelativo = strCorrelativo.replace("lblId" + sub, i);
                            strCorrelativo = strCorrelativo.replace("nombre" + sub, "trC");
                            strCorrelativo = strCorrelativo.replace("etiqueta" + sub, etiqueta);
                            strCorrelativo = strCorrelativo.replace("Valor" + sub, des1 + '-' + des2);

                        }
                        if (tipo == 'S') {

                            Cj++;
                            var sub = '';
                            if (Cj == 1) { j++; strStock += molde; }
                            if (Cj == 2) { sub = '1'; Cj=0 }

                            strStock = strStock.replace("IdTr" + sub, "trS" + j);
                            strStock = strStock.replace("lblId" + sub, j);
                            strStock = strStock.replace("nombre" + sub, "trS");
                            strStock = strStock.replace("etiqueta" + sub, etiqueta);
                            strStock = strStock.replace("Valor" + sub, des2);

                        }
                    });

                    strCorrelativo = strCorrelativo.replace("etiqueta1", "");
                    strCorrelativo = strCorrelativo.replace("Valor1", "");

                    strStock = strStock.replace("etiqueta1", "");
                    strStock = strStock.replace("Valor1", "");


                    var strhtml = ''

                    var pOcu = "ocultarFilas('trC',"+i+");mostrarDivFast('bverC'); ocultarDivFast('bocuC')"
                    var pVer = "mostrarFilas('trC',"+i+");ocultarDivFast('bverC'); mostrarDivFast('bocuC')"

                    var pOcuS = "ocultarFilas('trS',"+j+");mostrarDivFast('bverS'); ocultarDivFast('bocuS')"
                    var pVerS = "mostrarFilas('trS',"+j+");ocultarDivFast('bverS'); mostrarDivFast('bocuS')"

                    strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
                    strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                    strhtml += '<h5 class="modal-title" id="myModalLabel">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="font-size:14px;width:100%;text-align:left;">' + descTienda + '</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</h5>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-body">'
                    strhtml += '<table class="table table-striped" RULES="none">'
                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Jefe</label></td>'
                    strhtml += '<td colspan="3">'
                    strhtml += '<i class="fa fa-briefcase"></i>&nbsp;&nbsp;' + Jefe
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Consecionaria</label></td>'
                    strhtml += '<td colspan="3">'
                    strhtml += '<i class="fa fa-university"></i>&nbsp;&nbsp;' + Concesion
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Dirección</label></td>'
                    strhtml += '<td colspan="3">'
                    strhtml += '<i class="fa fa-map-marker"></i>&nbsp;&nbsp;' + Direccion
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Outlet</label></td>'
                    strhtml += '<td colspan="3">'
                    strhtml += '<i class="fa fa fa-bars"></i>&nbsp;&nbsp;' + outlet
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '<tr  id="tr1">'
                    //strhtml += '<td colspan="3" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:14px;padding:3px;padding-left:3px;font-weight:bold">&nbsp;&nbsp;Correlativos</td>'
                    strhtml += '<td colspan="4" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:15px;padding:3px;padding-left:3px;">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="color:#ffffff;font-size:15px;width:90%;text-align:left;padding-left:1px;">Correlativos</td>'
                    strhtml += '<td style="width:5%;text-align:right;">'
                    strhtml += '<span id="bocuC" onclick ="' + pOcu + '"  class="glyphicon glyphicon-eye-close"></span>'
                    strhtml += '<span id="bverC" onclick ="' + pVer + '" style="display:none" class="glyphicon glyphicon-eye-open""></span>'
                    strhtml += '&nbsp;</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += strCorrelativo
                    strhtml += '<tr  id="tr1">'
                    //strhtml += '<td colspan="3" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:14px;padding:3px;padding-left:3px;font-weight:bold">&nbsp;&nbsp;Stock</td>'
                    strhtml += '<td colspan="4" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:15px;padding:3px;padding-left:3px;">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="color:#ffffff;font-size:15px;width:90%;text-align:left;padding-left:1px;">Stock</td>'
                    strhtml += '<td style="width:5%;text-align:right;">'
                    strhtml += '<span id="bocuS" onclick ="' + pOcuS + '"  class="glyphicon glyphicon-eye-close"></span>'
                    strhtml += '<span id="bverS" onclick ="' + pVerS + '" style="display:none" class="glyphicon glyphicon-eye-open"></span>'
                    strhtml += '&nbsp;</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml +=  strStock
                    strhtml += '</table>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-footer" style="margin-top:-30px">'
                    strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'

                    strhtml += '</div>'
                    var options = { "backdrop": "static", keyboard: true };

                    $('#myModalContent').html(strhtml);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');


                }
                waitingDialog.hide();

            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }

        });

    }
    function PopupDetalleXcenter(codTienda, descTienda) {
        waitingDialog.show('Consultando XCENTER,Espere un momento por favor');

        var ControllerUrl = "@Url.Action("listarStr_DatosXcenterTienda", "XstoreTda")";

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { codTienda: codTienda },
            datatype: "json",
            cache: true,
            success: function (data) {
                if (data != '' && data != '[]') {
                    var gData = JSON.parse(data);

                    var strhtml = ''
                    strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
                    strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                    strhtml += '<h5 class="modal-title" id="myModalLabel">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="font-size:14px;width:100%;text-align:left;">' + descTienda + '</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</h5>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-body">'
                    strhtml += '<table class="table table-striped" RULES="none">'

                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>rtl_loc_id</label></td>'
                    strhtml += '<td colspan="5">'
                    strhtml += '<i class="glyphicon glyphicon-asterisk"></i>&nbsp;&nbsp;' + gData.tienda[0].rtl_loc_id
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Descripción</label></td>'
                    strhtml += '<td colspan="5">'
                    strhtml += '<i class="glyphicon glyphicon-file"></i>&nbsp;&nbsp;' + gData.tienda[0].description
                    strhtml += '</td>'
                    strhtml += '</tr>'
                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Dirección</label></td>'
                    strhtml += '<td colspan="5">'
                    strhtml += '<i class="fa fa-map-marker"></i>&nbsp;&nbsp;' + gData.tienda[0].address1
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Consecionaria</label></td>'
                    strhtml += '<td colspan="5">'
                    strhtml += '<i class="fa fa-university"></i>&nbsp;&nbsp;' + gData.tienda[0].store_name
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Jefe</label></td>'
                    strhtml += '<td colspan="5">'
                    strhtml += '<i class="fa fa-briefcase"></i>&nbsp;&nbsp;' + gData.tienda[0].store_manager
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr>'
                    strhtml += '<td colspan="1" valign="middle"><label>Calzado</label></td>'
                    strhtml += '<td colspan="1">'
                    strhtml += '<i class="glyphicon glyphicon-ok"></i>&nbsp;&nbsp;' + gData.tienda[0].xs_calzado
                    strhtml += '</td>'
                    strhtml += '<td colspan="1" valign="middle"><label>No Calzado</label></td>'
                    strhtml += '<td colspan="1">'
                    strhtml += '<i class="glyphicon glyphicon-ok"></i>&nbsp;&nbsp;' + gData.tienda[0].xs_no_calzado
                    strhtml += '</td>'
                    strhtml += '<td colspan="1" valign="middle"><label>Total</label></td>'
                    strhtml += '<td colspan="1">'
                    strhtml += '<i class="glyphicon glyphicon-ok"></i>&nbsp;&nbsp;' + gData.tienda[0].xs_total
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr  id="tr1" class="js-section">'
                    strhtml += '<td colspan="6" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:15px;padding:3px;padding-left:3px;">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="color:#ffffff;font-size:15px;width:90%;text-align:left;padding-left:1px;">Xstore</td>'
                    strhtml += '<td style="width:5%;text-align:right;">'

                    strhtml += '<span id="bocuC" onclick =""  class="js-accordion glyphicon glyphicon-eye-close" data-section="0"></span>'
                    strhtml += '<span id="bverC" onclick ="" style="display:none" class="glyphicon glyphicon-eye-open""></span>'

                    strhtml += '&nbsp;</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr id="IdTr">'
                    strhtml += '<td colspan="6" valign="middle" style="padding:0px;">'
                    strhtml += '<div class="content-id">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'

                    //cabecera
                    if (gData.xstore.length) {
                        strhtml += '<tr id="IdTr" class="bg-dark" >'
                        strhtml += '<td colspan="2" valign="middle"><label  id="lblId" name="nombre">wkstn_id</label></td>'
                        strhtml += '<td colspan="2" valign="middle"><label  id="lblId" name="nombre1">ip_address</label></td>'
                        strhtml += '<td colspan="2" valign="middle"><label  id="lblId" name="nombre1">xstore_version</label></td>'
                        strhtml += '</tr>'
                    }

                    gData.xstore.map(function (item) {
                        strhtml += '<tr id="IdTr"  >'

                        strhtml += '<td colspan="2">'
                        strhtml += item.wkstn_id
                        strhtml += '&nbsp;&nbsp;'
                        strhtml += '</td>'

                        strhtml += '<td colspan="2">'
                        strhtml += item.ip_address
                        strhtml += '</td>'

                        strhtml += '<td colspan="2">'
                        strhtml += item.xstore_version
                        strhtml += '</td>'
                        strhtml += '</tr>'
                    })

                    strhtml += '</table>'
                    strhtml += '</div>'
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr><td colspan="6"></td></tr>'

                    strhtml += '<tr  id="tr1" class="js-section">'
                    strhtml += '<td colspan="6" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:15px;padding:3px;padding-left:3px;">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'
                    strhtml += '<tr >'
                    strhtml += '<td style="color:#ffffff;font-size:15px;width:90%;text-align:left;padding-left:1px;">Documentos</td>'
                    strhtml += '<td style="width:5%;text-align:right;">'

                    strhtml += '<span id="bocuS" onclick =""  class="js-accordion glyphicon glyphicon-eye-close" data-section="0"></span>'
                    strhtml += '<span id="bverS" onclick ="" style="display:none" class="glyphicon glyphicon-eye-open"></span>'

                    strhtml += '&nbsp;</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '<tr id="IdTr"  >'
                    strhtml += '<td colspan="6" valign="middle" style="padding:0px;">'
                    strhtml += '<div class="content-id">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:100%;">'

                    //cabecera
                    if (gData.documento.length) {
                        strhtml += '<tr id="IdTr" class="bg-dark" >'
                        strhtml += '<td colspan="2" valign="middle"><label  id="lblId" name="nombre">Tipo</label></td>'
                        strhtml += '<td colspan="2" valign="middle"><label  id="lblId" name="nombre1">Serie</label></td>'
                        strhtml += '<td colspan="2" valign="middle"><label  id="lblId" name="nombre1">Correlativo</label></td>'
                        strhtml += '</tr>'
                    }

                    gData.documento.map(function (item) {
                        strhtml += '<tr id="IdTr">'
                        strhtml += '<td colspan="2">'
                        strhtml += item.tipo_doc
                        strhtml += '</td>'
                        strhtml += '<td colspan="2">'
                        strhtml += item.serie
                        strhtml += '</td>'
                        strhtml += '<td colspan="2">'
                        strhtml += item.correlativo
                        strhtml += '</td>'
                        strhtml += '</tr>'

                    })

                    strhtml += '</table>'
                    strhtml += '</div>'
                    strhtml += '</td>'
                    strhtml += '</tr>'

                    strhtml += '</table>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-footer" style="margin-top:-30px">'
                    strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'

                    strhtml += '</div>'
                    var options = { "backdrop": "static", keyboard: true };

                    $('#myModalContent').html(strhtml);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                }
                waitingDialog.hide();

            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }

        });

    }
    function PopupInterfacexDefecto(codTienda, descTienda, Direccion, Jefe, Concesion,outlet) {

        waitingDialog.show('Espere un momento por favor');
        var gTemRowOrce
        var gTemRow
        var ConstHtmlrow = '<div class="row" style="margin-top:10px;margin-left:1px;margin-right:1px;margin-bottom:10px;border-radius:5px;padding-top:10px;padding-bottom:10px;">';
            ConstHtmlrow += 'listDetalle</div>'
        var iconoProgramado = '<span class="glyphicon glyphicon-time"></span>'
        var iconoRapido = '<span class="glyphicon glyphicon-flash"></span>'

        var constControl = '<div class="col-sm-6" style="margin-top:2px;margin-bottom:2px;">';

        //var constControl = '<div class="col-sm-5" style="margin-top:2px;margin-bottom:2px;">'
         constControl += '<input id="grup_gxx" type="hidden" value="desgrupo"/>'
            constControl += '<input id="des_remm" type="hidden" value="descrip"/>'
            //constControl += 'tipoIcono' + '&nbsp;'
            //constControl += '<label for="disponible"></label>';
            //constControl += '</div>';

            constControl += '<label class="container"><input type="checkbox" id="IdCheck" checked name="Interface"><span class="checkmark"></span>tipoIcono&nbsp;descripcionDetalle</label>';
            constControl += '</div>'

        var ControllerUrl = "@Url.Action("listarStr_InterfacexDefecto", "XstoreTda")"

        $.ajax({
            type: "GET",
            url: ControllerUrl,
            contentType: "application/json; charset=utf-8",
            data: { cod_tda: codTienda },
            datatype: "json",
            cache: true,
            success: function (data) {

                if (data != '' && data != '[]') {

                    var valors = JSON.parse(data);
                    var DescripcionInterface = '';
                    var nroColum = 2;
                    var contColum = 0;
                    var contColumOrce = 0;
                    var gListRow = '';
                    var gTemRow = '';
                    var gListRowOrce = '';
                    var gTemRowOrce = '';

                    $.each(valors, function (index, item) {

                        var codEnt = item.Cod_Ent;
                        var codInterf = item.Cod_Interface;
                        var desInterf = item.Descripcion_Interface;

                        var strView = item.V_View
                        var strAuto = item.Cod_Auto

                        if (codEnt == '02') {

                            contColum++;

                            if (contColum > nroColum) {

                                gListRow += ConstHtmlrow.replace("listDetalle", gTemRow);
                                gTemRow = '';
                                contColum = 1
                            }

                            var StrControl = constControl;
                            var htmlbotontipo = strAuto == '1' ? iconoProgramado : iconoRapido;

                            StrControl = StrControl.replace("descripcionDetalle", desInterf);
                            StrControl = StrControl.replace("IdCheck", codInterf);
                            StrControl = StrControl.replace("tipoIcono", htmlbotontipo);
                            StrControl = StrControl.replace("descrip", desInterf);
                            StrControl = StrControl.replace("remm", codInterf);
                            StrControl = StrControl.replace("desgrupo", codEnt);
                            StrControl = StrControl.replace("gxx", codInterf);
                            StrControl = StrControl.replace("CodInterface", "'" + desInterf + "'");

                            gTemRow += StrControl

                        } else {
                            contColumOrce++;

                            if (contColumOrce > nroColum) {
                                gListRowOrce += ConstHtmlrow.replace("listDetalle", gTemRowOrce);
                                gTemRowOrce = '';
                                contColumOrce = 1
                            }

                            var StrControl = constControl;
                            var htmlbotontipo = strAuto == '1' ? iconoProgramado : iconoRapido;

                            StrControl = StrControl.replace("descripcionDetalle", desInterf);
                            StrControl = StrControl.replace("IdCheck", codInterf);
                            StrControl = StrControl.replace("tipoIcono", htmlbotontipo);
                            StrControl = StrControl.replace("descrip", desInterf);
                            StrControl = StrControl.replace("remm", codInterf);
                            StrControl = StrControl.replace("desgrupo", codEnt);
                            StrControl = StrControl.replace("gxx", codInterf);
                            StrControl = StrControl.replace("CodInterface", "'" + codInterf + "'");

                            gTemRowOrce += StrControl
                        }

                    });

                    if (gTemRow != '')
                        gListRow += ConstHtmlrow.replace("listDetalle", gTemRow);

                    if (gTemRowOrce != '')
                        gListRowOrce += ConstHtmlrow.replace("listDetalle", gTemRowOrce);

                    var strhtml =''
                    strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
                    strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
                    strhtml += '<h5 class="modal-title" id="myModalLabel">'
                    strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
                    strhtml += '<tr>'
                    strhtml += '<td style="font-size:14px;width:100%;text-align:left;">' + descTienda + '</td>'
                    strhtml += '</tr>'
                    strhtml += '</table>'
                    strhtml += '</h5>'
                    strhtml += '</div>'
                    strhtml += '<div class="modal-body">'
                    strhtml += '&nbsp;&nbsp;<b>Esta seguro de enviar a la tienda ' + descTienda + ' las siguientes interfaces ?   :</b><br/>'
                    strhtml += gListRow
                    strhtml += '</div>'
                    strhtml += '<div class="modal-footer">'
                    strhtml += '<div id="divtienda" style="display:none">' + codTienda + '</div>'

                    strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'
                    strhtml += '<button type="button" class="btn btn-primary"  onclick="GuardarInterface()"  >Enviar Interface</button>'
                    strhtml += '</div>'

                    var options = { "backdrop": "static", keyboard: true };

                    $('#myModalContent').html(strhtml);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                }
                waitingDialog.hide();
            },
            error: function () {
                waitingDialog.hide();
                alert('Error')
            }
        });
    }

    function PopupDetalle_bk(codTienda, descTienda,Direccion,Jefe,Concesion) {

        var strhtml = ''
        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:100%;text-align:left;">' + descTienda + '</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += '<table class="table table-striped" RULES="none">'
        strhtml += '<tr>'
        strhtml += '<td colspan="1" valign="middle"><label>Jefe</label></td>'
        strhtml += '<td colspan="2">'
        strhtml += '<i class="fa fa-briefcase"></i>&nbsp;&nbsp;' + Jefe
        strhtml += '</td>'
        strhtml += '</tr>'
        strhtml += '<tr>'
        strhtml += '<td colspan="1" valign="middle"><label>Consecionaria</label></td>'
        strhtml += '<td colspan="2">'
        strhtml += '<i class="fa fa-university"></i>&nbsp;&nbsp;' + Concesion
        strhtml += '</td>'
        strhtml += '</tr>'
        strhtml += '<tr>'
        strhtml += '<td colspan="1" valign="middle"><label>Dirección</label></td>'
        strhtml += '<td colspan="2">'
        strhtml += '<i class="fa fa-map-marker"></i>&nbsp;&nbsp;'+Direccion
        strhtml += '</td>'
        strhtml += '</tr>'
        strhtml += '<tr  id="tr1">'
        strhtml += '<td colspan="3" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:14px;padding:3px;padding-left:3px;font-weight:bold">&nbsp;&nbsp;Correlativos</td>'
        strhtml += '</tr>'
        strhtml += '<tr  id="tr1">'
        strhtml += '<td colspan="3" valign="middle"  bgcolor="#9A9897" style="color:#ffffff;font-size:14px;padding:3px;padding-left:3px;font-weight:bold">&nbsp;&nbsp;Stock</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'

        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');

    }


    function PopupGenerarCorrelativo(codTienda, descTeinda) {

        var strhtml = ''
        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Confirmar Generacion de correlativos</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += 'Desea Generar correlativos para la tienda: <b>' + descTeinda + '</b> ?.'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'
        strhtml += '<button type="button" class="btn btn-primary"  onclick="GenerarCorrelativoTienda(' + codTienda + ',1)"   data-dismiss="modal">Generar Correlativos</button>'
        //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
        //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');

    }

    function GenerarCorrelativoTienda(codEntid) {

        waitingDialog.show('Espere un momento por favor');

        var objTienda = {
            CodTienda: codEntid
        }

        var msj = 'Se genero los correlativos para la tienda Nro: ' + codEntid


        $.ajax
          ({
              url: '../XstoreTda/GenerarCorrelativoTienda',
              dataType: "json",
              type: "POST",
              data: objTienda,
              success: function (data, textStatus, XMLHttpRequest) {
                  waitingDialog.hide();

                  if ((data.Success).toString() == "true") {

                      if (data.Message == "1") {
                          toastr.success(msj);
                          MostrarListado();
                          waitingDialog.hide();

                      } else {

                          toastr.error("No se genero correlativos para la tienda : " + codEntid, "Error");
                          MostrarListado();
                          waitingDialog.hide();
                      }

                  } else {
                      toastr.error("No se genero correlativos para la tienda : " + codEntid, "Error");
                      waitingDialog.hide();
                  }

              },
              error: function (xhr) {
                  waitingDialog.hide();
                  toastr.error(xhr, 'Error');
                  waitingDialog.hide();
              }
          })

    }

    function Obtenertotales() {

        waitingDialog.show('Espere un momento por favor');

        var objTienda = {
        }

        $.ajax
          ({
              url: '../XstoreTda/GetTotales',
              dataType: "json",
              type: "POST",
              data: objTienda,
              success: function (data, textStatus, XMLHttpRequest) {
                  waitingDialog.hide();

                  if ((data.Success).toString() == "true") {

                      document.getElementById("TotalXstore").innerHTML = '<label for="segape">' + data.Message + '</label>'
                      document.getElementById("TotalNXstore").innerHTML = '<label for="segape">' + data.Data + '</label>'

                  }
              },
              error: function (xhr) {
                  waitingDialog.hide();
                  toastr.error(xhr, 'Error');
                  waitingDialog.hide();
              }
          })
    }

    function ocultarFilas(nombre, cantidad) {

        for (var i = 1; i <= cantidad; i++) {
            ocultarDivFast(nombre + i)
        }
    }

    function mostrarFilas(nombre, cantidad) {

        for (var i = 1; i <= cantidad; i++) {
            mostrarDivFast(nombre + i)
        }
    }

    function ocultarDivFast(divId) {

        $("#" + divId).hide();
    }

    function mostrarDivFast(divId) {

        $("#" + divId).show();
    }

    function GuardarInterface() {

        var Id = '';
        var Interface_strList = '';
        var msg_titulo = 'Mensaje ';
        var CodTda = $("#divtienda").html();

        $('input[name="Interface"]').each(function () {

            Id = $(this).attr("id");
            if ($("#" + Id).is(':checked')) {
                Interface_strList += 'row1 cod_interf="' + Id + '" row2'
            }

        });

        if (Interface_strList != '') {
            $('#myModal').modal('hide');
            waitingDialog.show('Espere un momento por favor');

            var objInterface = {
                Cod_Tda: CodTda,
                List_strListDetalle: Interface_strList
            }

            $.ajax
             ({
                 url: '../Interface/GuardarInterface',
                 dataType: "json",
                 type: "POST",
                 data: objInterface,
                 success: function (data, textStatus, XMLHttpRequest) {
                     var strId = data.Message;

                     waitingDialog.hide();
                     toastr.success("Las interface fueron guardardo para su generación.", msg_titulo);


                 },
                 error: function (xhr) {
                     waitingDialog.hide();
                     toastr.error(xhr, msg_titulo);
                 }
             })
        } else {
            toastr.error('Debe seleccionar al menos un Interface.', msg_titulo);

        }
    }

    function PopupVentasHistoricas(codTienda, descTienda, Direccion, Jefe, Concesion) {

        var TeamDetailPostBackURL ="@Url.Action("VentaHistorica", "XstoreTda")";

        waitingDialog.show('Espere un momento por favor');

        var obj = {
            cod_Tda: codTienda,
            descTienda: descTienda
        }


        var options = { "backdrop": "static", keyboard: true };
        $.ajax({
            type: "GET",
            url: TeamDetailPostBackURL,
            contentType: "application/json; charset=utf-8",
            data: obj,
            datatype: "json",
            cache: true,
            success: function (data) {

                waitingDialog.hide();
                $('#myModalContent').html(data);
                $('#myModal').modal(options);
                $('#myModal').modal('show');

            },
            error: function () {
                waitingDialog.hide();
                alert("Dynamic content load failed.");
            }
        });

    }

    function generarInterfaceVenta(codTienda) {

        if (validarfecha()) {

            var Id = '19';//codigo de interface de historico de ventas
            var fecIni = ($("#fecini").val()).split('-');
            var fecFin = ($("#fecfin").val()).split('-');
            var strIni = fecIni[2] + fecIni[1] + fecIni[0];
            var strFin = fecFin[2] + fecFin[1] + fecFin[0];

            var Interface_strList = '';
            var msg_titulo = 'Mensaje ';
            var CodTda = codTienda;

            Interface_strList += 'row1 cod_interf="' + Id + '"  fec_ini="' + strIni + '"  fec_fin="' + strFin + '"      row2'

            if (Interface_strList != '') {
                $('#myModal').modal('hide');
                waitingDialog.show('Espere un momento por favor');

                var objInterface = {
                    Cod_Tda: CodTda,
                    List_strListDetalle: Interface_strList
                }

                $.ajax
                 ({
                     url: '../Interface/GuardarInterface',
                     dataType: "json",
                     type: "POST",
                     data: objInterface,
                     success: function (data, textStatus, XMLHttpRequest) {
                         var strId = data.Message;

                         waitingDialog.hide();
                         toastr.success("Las interface de venta fue guardardo para su generación.", msg_titulo);


                     },
                     error: function (xhr) {
                         waitingDialog.hide();
                         toastr.error(xhr, msg_titulo);
                     }
                 })
            } else {
                toastr.error('Debe seleccionar al menos un Interface.', msg_titulo);

            }

        }

    }

    function validarfecha() {

        var validacion = true

        var strMensaje = '';

        var valCompra_fecVigenIni = $("#fecini").val();
        var valCompra_fecVigenFin = $("#fecfin").val();

        var partsini = valCompra_fecVigenIni.split('-');
        var partsfin = valCompra_fecVigenFin.split('-');

        var mydateIni = new Date(partsini[2], partsini[1] - 1, partsini[0]);
        var mydateFin = new Date(partsfin[2], partsfin[1] - 1, partsfin[0]);
        var mydatehoy = new Date();


        if (mydatehoy < mydateIni)
            strMensaje += '* la fecha inicio debe ser menor o igual al actual.  <br/>'

        if (mydatehoy < mydateFin)
            strMensaje += '* la fecha fin debe ser menor o igual al actual.  <br/>'

        if (mydateIni > mydateFin)
            strMensaje += '* la fecha fin debe ser mayor o igual a la fecha inicial.  <br/>'



        if (strMensaje != '') {
            validacion = false;
            toastr.error(strMensaje, "Mensaje");
            validacion= false
        }

        return validacion;
    }

    function PopupGenerarStock(codTienda, descTienda, Direccion, Jefe, Concesion) {

        var strhtml = ''
        strhtml += '<div class="modal-header modal-header-danger" style="margin-top:0px;margin-bottom:0px;padding-top:2px;padding-bottom:2px;">'
        strhtml += '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>'
        strhtml += '<h5 class="modal-title" id="myModalLabel">'
        strhtml += '<table style="border-bottom:0px;font-size:14px;width:50%;">'
        strhtml += '<tr>'
        strhtml += '<td style="font-size:14px;width:100%;text-align:left;">Confirmar envio de Stock</td>'
        strhtml += '</tr>'
        strhtml += '</table>'
        strhtml += '</h5>'
        strhtml += '</div>'
        strhtml += '<div class="modal-body">'
        strhtml += 'Desea enviar la interface de stock de la tienda : <b>' + descTienda + '</b> ?.'
        strhtml += '</div>'
        strhtml += '<div class="modal-footer" style="margin-top:-30px">'
        strhtml += '<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>'
        strhtml += '<button type="button" class="btn btn-primary"  onclick="generarInterfaceStock(' + codTienda + ')"   data-dismiss="modal">Enviar stock</button>'
        //strhtml += ' <button type="button"  title="Eliminar class="btn btn-danger" data-dismiss="modal" detalle" onclick="EliminarDetalle(this)"  data-id="' + codArticulo + '" data-modal="" data-toggle="modal">Elimninar</button>';
        //strhtml += '<input type="submit" class="btn btn-primary" onclick="agregarLista()"  id="btnSubmit" value="Agregar" />'
        strhtml += '</div>'
        var options = { "backdrop": "static", keyboard: true };

        $('#myModalContent').html(strhtml);
        $('#myModal').modal(options);
        $('#myModal').modal('show');
    }

    function generarInterfaceStock(codTienda) {

            var Id = '10';//codigo de interface de STOCK
            var Interface_strList = '';
            var msg_titulo = 'Mensaje ';
            var CodTda = codTienda;

            Interface_strList += 'row1 cod_interf="' + Id + '"      row2'

            if (Interface_strList != '') {
                $('#myModal').modal('hide');
                waitingDialog.show('Espere un momento por favor');

                var objInterface = {
                    Cod_Tda: CodTda,
                    List_strListDetalle: Interface_strList
                }

                $.ajax
                 ({
                     url: '../Interface/GuardarInterface',
                     dataType: "json",
                     type: "POST",
                     data: objInterface,
                     success: function (data, textStatus, XMLHttpRequest) {
                         var strId = data.Message;

                         waitingDialog.hide();
                         toastr.success("Las interface de stock fue guardardo para su generación.", msg_titulo);

                     },
                     error: function (xhr) {
                         waitingDialog.hide();
                         toastr.error(xhr, msg_titulo);
                     }
                 })
            } else {
                toastr.error('Debe seleccionar al menos un Interface.', msg_titulo);

            }



    }


    function GuardarInterface() {

        var Id = '';
        var Interface_strList = '';
        var msg_titulo = 'Mensaje ';
        var CodTda = $("#divtienda").html();

        $('input[name="Interface"]').each(function () {

            Id = $(this).attr("id");
            if ($("#" + Id).is(':checked')) {
                Interface_strList += 'row1 cod_interf="' + Id + '" row2'
            }

        });

        if (Interface_strList != '') {
            $('#myModal').modal('hide');
            waitingDialog.show('Espere un momento por favor');

            var objInterface = {
                Cod_Tda: CodTda,
                List_strListDetalle: Interface_strList
            }

            $.ajax
             ({
                 url: '../Interface/GuardarInterface',
                 dataType: "json",
                 type: "POST",
                 data: objInterface,
                 success: function (data, textStatus, XMLHttpRequest) {
                     var strId = data.Message;

                     waitingDialog.hide();
                     toastr.success("Las interface fueron guardardo para su generación.", msg_titulo);


                 },
                 error: function (xhr) {
                     waitingDialog.hide();
                     toastr.error(xhr, msg_titulo);
                 }
             })
        } else {
            toastr.error('Debe seleccionar al menos un Interface.', msg_titulo);

        }
    }
</script>

